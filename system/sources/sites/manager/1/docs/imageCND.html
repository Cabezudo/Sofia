<!DOCTYPE html>
<html profiles="all">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sofia Server</title>
    <link rel="stylesheet" type="text/css" href="/css/docs/imageCND.css">
    <script src="/js/variables.js"></script>
    <script src="/js/docs/imageCND.js"></script>
    <script lib="core/0.1.0"></script>
    <script lib="simpleSICEditor/0.1.0"></script>
    <script lib="button/0.1.0"></script>
    <style>
      .imageContainer {
        width: content-box;
        overflow: auto;
        position: relative;
      }
      .buttonContainer {
        display: flex;
        align-items: baseline;
      }
      .runButton {
        flex-grow: 0;
        width: min-content;
      }
    </style>
    <script>
      {
        const imageContainer = ({ id = null, element = null, width = null, height = null, src = null } = {}) => {
          let image;
          const validateOptions = () => {
            if (element === null && id === null) {
              throw Error('You must define a property id or a property element for the image.');
            }
          };
          const createGUI = () => {
            if (element === null) {
              element = Core.validateById(id);
            }
            element.className = 'imageContainer';
            const ratio = width / height;
            element.style.height = `${element.offsetWidth / ratio}px`;
            image = document.createElement("IMG");
            element.appendChild(image);
            image.src = src;
          };
          const setFunctions = () => {
            element.setSRC = src => {
              image.src = src;
            };
          };
          const assignTriggers = () => {

          };
          validateOptions();
          createGUI();
          setFunctions();
          assignTriggers();
        };

        const createGUI = () => {
          let image, exampleMessages;
          ;
          const createCodeExample = (id) => {
            const container = Core.validateById(id);
            const code = container.innerText;
            Core.removeChilds(container);
            const editor = document.createElement("DIV");
            editor.innerText = code;
            container.appendChild(editor);

            const buttonContainer = document.createElement("DIV");
            buttonContainer.className = 'buttonContainer';
            const button = document.createElement("DIV");
            button.innerText = 'Run';
            buttonContainer.appendChild(button);
            exampleMessages = document.createElement("DIV");
            buttonContainer.appendChild(exampleMessages);
            container.appendChild(buttonContainer);

            image = document.createElement("DIV");
            container.appendChild(image);
            simpleSICEditor({
              element: editor,
              focus: true,
              onError: () => {
                Core.trigger(button, 'disabled');
              },
              onCompile: () => {
                Core.trigger(button, 'enabled');
              },
              onMessage: message => {
                console.log(message);
                exampleMessages.innerHTML = message;
              }
            });
            blueButton({
              element: button,
              enabled: false,
              onClick: () => {
                const code = editor.getURLCode();
                const src = `/images/test.jpg?${code}`;
                image.setSRC(src);
              }
            });
            button.classList.add('runButton');
            imageContainer({
              element: image,
              src: "/images/test.jpg",
              width: 1200,
              height: 800
            });
          };
          createCodeExample('01');
        };
        Core.addOnloadFunction(createGUI);
      }
      ;
    </script>
    <style file="documentation.css"></style>
  </head>
  <body>
    <section id="application">
      <section id="header" template="headers/menu/simple/menu" configurationFile="menu.json"></section>
      <section class="content">
        <section class="container">
          <div class="documentation">
            <section id="introducingSofia" class="documentation">
              <div id="01">main(loadImage(name=/images/test.jsp),resize(width=600,height=400))</div>
              <span class="title">Image CND and SIC</span>
              <h1>What's an image CDN?</h1>
              <p>Image CDN specialize in the transformation, optimization, and delivery of images. You can also think of them as APIs for accessing and manipulating the images used on your site.</p>
              <h1>Why use an image CDN?</h1>
              <p>Image content delivery networks (CDNs) are excellent at optimizing images.</p>
              <h1>What's SIC?</h1>
              <p>SIC stand for Sofia Image Code. Is a functional language for WS API image manipulation.</p>
              <h1>How does it work?</h1>
              <p>You have one image upladed on the server. In the string query, you manipulate it with SIC in order to get a diferent image. For responsive sites, you upload one image, a big image, and manipulete it in order to get a diferent image accord your device, for example smaller.</p>
              <p>How do you do that? Just add the SIC code in the URL query string.</p>
              <p>The folow is an example of SIC code used to resize an image.</p>
              <pre>main(
  loadImage(
    name=/home/esteban/images/test.jpg
  ),
  resize(
    width = 1200,
    height = 800
  )
)</pre>
              <p>But using the CDN some code disapear and is addeded by the server. So, the URL query string look like this:</p>
              <pre>test.jpg?resize(width=1200,height=800)</pre>
              <p>Let's test the code directly on the server.</p>
              <textarea id="_firstProgram">resize(
  width = 1200,
  height = 800
)</textarea>
            </section>
            <br><br><br><br><br><br><br><br><br><br><br><br>
          </div>
        </section>
      </section>
      <section id="footer" file="footer.html"></section>
    </section>
  </body>
</html>