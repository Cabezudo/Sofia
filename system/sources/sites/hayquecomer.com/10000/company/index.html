<!DOCTYPE html>
<html profiles="all">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu digital</title>
    <link rel="stylesheet" type="text/css" href="index.css">
    <script src="variables.js"></script>
    <script src="index.js"></script>
    <script lib="core/0.1.0"></script>
    <script lib="image/0.1.0"></script>
    <script>
      {
        let
                info, categoriesContainerElement, categoryElementContainer = [], elementContainerSelected = 0,
                dishGroupsContainerElement, dishGroupsElement = [];
        const setCategorySelected = () => {
          for (let i = 0; i < categoryElementContainer.length; i++) {
            if (elementContainerSelected === i) {
              categoryElementContainer[i].className = 'category selected';
              Core.show(dishGroupsElement[i]);
            } else {
              categoryElementContainer[i].className = 'category';
              Core.hide(dishGroupsElement[i]);
            }
          }
        };
        const createMenu = menu => {
          for (let i = 0; i < menu.length; i++) {
            const category = menu[i];
            const categoryName = category.name;
            categoryElementContainer[i] = document.createElement('DIV');
            categoryElementContainer[i].onclick = () => {
              elementContainerSelected = i;
              setCategorySelected();
            };
            categoryElementContainer[i].innerHTML = `<div class="categoryName">${categoryName}</div><div class="categoryTime">Wed 12:30 PM â€“ 6:15 PM</div>`;
            categoriesContainerElement.appendChild(categoryElementContainer[i]);
            const categorySpace = document.createElement('DIV');
            categorySpace.className = 'categorySpace';
            categoriesContainerElement.appendChild(categorySpace);

            dishGroupsElement[i] = document.createElement('DIV');
            dishGroupsElement[i].className = 'dishGroups';

            dishGroupsContainerElement.appendChild(dishGroupsElement[i]);
            const dishGroups = category.dishGroups;
            console.log(dishGroups);
            dishGroups.forEach(dishGroup => {
              const dishGroupElement = document.createElement('DIV');
              dishGroupElement.innerHTML = `<div class="dishGroupTitle">${dishGroup.name}</div>`;
              dishGroupsElement[i].appendChild(dishGroupElement);
              const dishesContainerElement = document.createElement('DIV');
              dishesContainerElement.className = 'dishes';
              dishGroupElement.appendChild(dishesContainerElement);
              const dishes = dishGroup.dishes;
              dishes.forEach(dish => {
                const dishElement = document.createElement('DIV');
                dishElement.className = 'dish';
                dishesContainerElement.appendChild(dishElement);

                const dishDataElement = document.createElement('DIV');
                dishDataElement.className = 'dishData';
                dishDataElement.innerHTML =
                        `<div class="dishName">${dish.name}</div><div class="dishDescription">${dish.description === null ? '' : dish.description}</div><div class="dishPrice">${dish.price.currency}${dish.price.cost}</div>`;
                dishElement.appendChild(dishDataElement);

                if (dish.imageName !== null) {
                  const dishImageElement = document.createElement('DIV');
                  dishImageElement.className = 'dishImage';
                  dishElement.appendChild(dishImageElement);
                  image({element: dishImageElement, src: `/images/${dish.imageName}?resize(height=180)`});
                }
              });

            });
          }
          setCategorySelected();
        };

        const createGUI = () => {
          info = document.getElementById('info');
          info.addEventListener('response', event => {
            const detail = event.detail;
            const restaurant = detail.restaurant;
            const setData = (id, html) => {
              document.getElementById(id).innerHTML = html;
            };
            document.getElementById('image').style.backgroundImage = `url('/images/${restaurant.imageName}')`;
            setData('name', restaurant.name);
            let typeAndCost = '';
            if (restaurant.type) {
              typeAndCost = `<div>${restaurant.type.name}</div>`;
            }
            switch (restaurant.priceRange) {
              case 1:
                typeAndCost += '&nbsp;&middot;&nbsp;<div class="cost">$</div>';
                break;
              case 2:
                typeAndCost += '&nbsp;&middot;&nbsp;<div class="cost">$$</div>';
                break;
              case 3:
                typeAndCost += '&nbsp;&middot;&nbsp;<div class="cost">$$$</div>';
            }
            setData('typeAndCost', typeAndCost);
            let score = '';
            if (restaurant.score) {
              score = restaurant.score;
              if (restaurant.numberOfVotes) {
                score += ` (${restaurant.numberOfVotes})`;
              }
              setData('score', score);
            }
            setData('name', restaurant.name);
            createMenu(detail.menu);
          });
          categoriesContainerElement = document.getElementById('categories');
          dishGroupsContainerElement = document.getElementById('dishGroups');
        };
        const loadData = () => {
          Core.sendGet(`/api/v1/restaurants/${variables.company.host}/menu`, info);
        };
        Core.addOnloadFunction(createGUI);
        Core.addOnloadFunction(loadData);
      }
    </script>
    <style>
      #image {
        background-size: cover;
        background-repeat: no-repeat;
        background-position: center;
        height: 240px;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      #info {
        background-color: white;
        width: 70%;
        text-align: center;
        font-size: 14px;
        padding: 20px;
      }
      #name {
        font-size: 32px;
        font-weight: 700;
      }
      #typeAndCost {
        align-items: center;
        display: flex;
        justify-content: center;
        padding: 10px 0 0 0;
        font-size: 14px;
      }
      .cost {
        display: inline-block;
        font-size: 12px;
      }

      #menu {
        padding: 0 20px;
        max-width: 550px;
        margin: auto;
      }

      #categories {
        display: flex;
        flex-direction: row;
      }
      .category {
        flex-direction: column;
        align-content: flex-start;
        display: flex;
        padding: 20px 0 ;
        border-bottom: 1px solid buttonhighlight;
      }
      .selected {
        border-bottom: 2px solid black;
      }
      .categoryName {
        font-size: 16px;
        font-weight: 500;
        color: rgb(50, 50, 50);
      }
      .categoryTime {
        color: rgb(100, 100, 100);
        font-size: 12px;
      }
      .categorySpace {
        display: flex;
        width: 20px;
        border-bottom: 1px solid buttonhighlight;
      }
      .categorySpace:last-child {
        flex-grow: 2;
      }
      .dishGroups {

      }
      .dishGroup {

      }
      .dishGroupTitle {
        font-size: 22px;
        font-weight: 800;
        margin: 20px 0;
      }
      #dishes {
      }
      .dish {
        display: flex;
        justify-content: space-between;
        margin: 20px 0;
        border: 1px solid rgb(220, 220, 220);
      }
      .dishData {
        display: flex;
        flex-direction: column;
        margin: 20px;
        color: rgb(80, 80, 80);
      }
      .dishName {
        flex-grow: 0;
        margin-bottom: 10px;
        font-size: 18px;
        font-weight: 700;
      }
      .dishDescription {
        flex-grow: 0;
        font-size:16px;
      }
      .dishPrice {
        font-family: Lato;
        flex-grow: 1;
        align-items: flex-end;
        display: flex;
        font-weight: 400;
        font-size:16px;
        color: rgb(100, 100, 100);
        margin-top: 20px;
      }
      .dishImage {
        flex-basis: 180px;
        flex-grow: 0;
        flex-shrink: 0;
        height: 180px;
        background-position: center;
        background-repeat: no-repeat;
      }
      @media all and ( min-width: 750px ) {
        #image {
          height: 300px;
          justify-content: flex-start;
        }
        #info {
          width: 50%;
          text-align: left;
        }
        #name {
          font-size: 36px;
          font-weight: 500;
        }
        #typeAndCost {
          justify-content: flex-start;
        }
        #menu {
          width: 550px;
        }
      }
      @media all and ( min-width: 1024px ) {
        #image {
          height: 300px;
          justify-content: flex-start;
        }
        #info {
          width: 50%;
          text-align: left;
        }
        #name {
          font-size: 36px;
          font-weight: 500;
        }
        #typeAndCost {
          justify-content: flex-start;
        }
        #menu {
          width: fit-content;
          margin: 40px;;
          max-width: fit-content;
        }
        .dishes {
          display: flex;
          justify-content: space-between;
          flex-wrap: wrap;
        }
        .dish {
          width: 48%;
          display: inline-flex;
        }
      }
      @media all and ( min-width: 1250px ) {
        .dish {
          width: 32%;
        }
      }
    </style>
  </head>
  <body>
    <section id="application" class="application">
      <section class="header"></section>
      <section class="restaurant">
        <div id="image">
          <div id="info">
            <div id="name">&nbsp;</div>
            <div id="typeAndCost">&nbsp;</div>
            <div id="score"></div>
            <div id="address"></div>
          </div>
        </div>
      </section>
      <section id="menu">
        <section id="categories"></section>
        <section id="dishGroups"></section>
      </section>
      <section class="footer"></section>
    </section>
  </body>
</html>

